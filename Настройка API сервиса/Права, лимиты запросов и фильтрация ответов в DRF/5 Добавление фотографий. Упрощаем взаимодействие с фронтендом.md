[[Фреймворк Django. Работа с проектами]]
[[Python]]
[[API]]
[[Питон Практикум]]

# Добавление фотографий. Упрощаем взаимодействие с фронтендом

На очередной планёрке коллеги-фронтендеры бодро отрапортовали, что дизайн Kittygram уже `свёрстан` в HTML и сейчас настраивается отображение картинок, которые должны приходить с бэкенда.

Но картинок нет. Это нужно оперативно исправить.

# Kittygram Backend

Коллеги попросили внести в бэкенд проекта изменения, которые позволят упростить взаимодействие с фронтендом. Склонируйте и разверните у себя обновлённую версию проекта — она доступна в репозитории [Kittygram Backend](https://github.com/yandex-praktikum/kittygram_backend).

Вот что изменилось в новой версии проекта:

- Эндпоинты API теперь доступны через префикс _api/_, а по адресу главной страницы в дальнейшем будет отображаться фронтенд для пользователей.
- Вместо токенов JWT подключены токены Authtoken; возможностей Authtoken для работы с проектом будет вполне достаточно.
- Работа с токенами и пользователями через API реализована при помощи возможностей модуля [djoser](https://djoser.readthedocs.io/en/latest/index.html).
- Цвет котиков больше не выбирается из предустановленных вариантов: теперь бэкенд ожидает, что цвет будет передан строкой, в формате hex, например — `#c8ff3b`. В запросах ожидаются коды только именованных цветов.
- В модель `Cat` добавлено поле для изображений.
- В сериализатор `CatSerializer` тоже добавлено поле для изображений, а также метод `update`, который отвечает за обновление информации о котиках.

Рассмотрим изменения детальнее.

## Authtoken вместо JWT

Просматривать и добавлять котиков в Kittygram могут только зарегистрированные пользователи, авторизация проверяется по токену.

Управление пользователями и токенами, как и прежде, реализуется через djoser, но вместо токенов JWT было решено использовать Authtoken.

В файл _settings.py_ уже добавлены соответствующие приложения и настройки:

```python
# kittygram_backend/settings.py

...

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'rest_framework.authtoken',
    'rest_framework',
    'djoser',
    'cats.apps.CatsConfig',
]

...

REST_FRAMEWORK = {
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticated', 
    ],
    # Изменили токен, вместо JWT подключили auth_token:
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework.authentication.TokenAuthentication',
    ],

    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 10,

}

... 
```

## Работа с токенами и пользователями через API

В головном _urls.py_ подключены эндпоинты модуля djoser:

```python
# kittygram_backend/urls.py

from rest_framework import routers

from django.contrib import admin
from django.urls import include, path

from cats.views import AchievementViewSet, CatViewSet


router = routers.DefaultRouter()
router.register(r'cats', CatViewSet)
router.register(r'achievements', AchievementViewSet)

urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/', include(router.urls)),
    path('api/', include('djoser.urls')),  # Работа с пользователями.
    path('api/', include('djoser.urls.authtoken')),  # Работа с токенами.
] 
```

## Hex-формат цветов и поле для картинок

Вместо выбора через `choices` бэкенд ожидает в запросах именованные цвета в hex-формате. Кроме этого, в модель `Cat` добавлено поле `image`:

```python
# cats/models.py

...

class Cat(models.Model):
    name = models.CharField(max_length=16)
    # Изменяем поле color: заменяем тип поля на «строка».
    # Несмотря на то, что цвет в формате hex описывается максимум шестью символами,
    # оставим max_length=16: ведь в базе 
    # уже могут быть сохранены старые и длинные названия цветов.
    color = models.CharField(max_length=16)
    birth_year = models.IntegerField()
    owner = models.ForeignKey(
        User, 
        related_name='cats', 
        on_delete=models.CASCADE
        )
    achievements = models.ManyToManyField(Achievement, through='AchievementCat')
    # Новое необязательное поле: где-то же надо хранить картинки!
    image = models.ImageField(
        upload_to='cats/images/', 
        null=True,  
        default=None
        )

    def __str__(self):
        return self.name

... 
```

Изображения, полученные в запросах, должны сохраняться в каталоге _cats/images/_. Для этого в настройках проекта определена директория медиафайлов:

```python
# kittygram_backend/settings.py

import os

...

MEDIA_URL = '/media/'
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')

... 
```

В головном _urls.py_ включена обработка медиафайлов в режиме отладки:

```python
# kittygram_backend/urls.py

from django.conf import settings
from django.conf.urls.static import static

...

if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT) 
```

В прежней версии проекта поля `image` не было. Чтобы задействовать его в работе API, потребовалось изменить сериализатор для модели `Cat`.

Однако тут есть один интересный момент. API Kittygram принимает и возвращает данные в формате JSON, это **текстовый** формат. Но чтобы пользователь мог отправить или получить фотографию, необходимо передать **бинарные данные**, то есть файл изображения; сделать это напрямую через JSON невозможно. Разберёмся, как найти выход из этой ситуации.

**Передача файлов в JSON**

Ещё раз сформулируем проблему: как передать файл, содержащий набор бинарных данных, если формат обмена данными поддерживает только текст?

Можно всех обмануть и вообще не передавать файлы через JSON: файлы загружать на сторонний сервер через какой-то другой интерфейс, а в JSON передавать не сам файл, а ссылку на него. Всё будет работать, ведь ссылка — это просто текстовая строка. С одной стороны — выгодно: ссылка гораздо «легче» файла, её быстрее передавать; с другой стороны — понадобится отдельный сервер или облачный сервис для хранения изображений, а это дополнительные затраты — финансовые, временные и трудовые. Для такого небольшого проекта как Kittygram они неоправданны.

Есть и другой подход: перед отправкой можно преобразовать бинарные данные в текстовый формат, затем передать получившуюся текстовую строку через JSON, а при получении превратить строку обратно в бинарные данные, то есть в файл.

Один из способов такого преобразования — это использование [Base64](https://datatracker.ietf.org/doc/html/rfc4648). Любую двоичную информацию, при таком кодировании, можно представить в виде текста или декодировать обратно.

Например, закодированное в base64 изображение может быть представлено такой строкой:

```
data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAAEsCAIAAABi1XKVAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAqENJREFUeNrsvX1wVVWeLrxPgi0EkUREgqAhoTtq3kGIet8WPcCzFq/d+/wYcMuO3fOkCnZo4W8BtmfLNFMKsBVGVLEOSXoN3wgLj073IrU9tp0D70ORlW17Vi1zVd0KhSV6J+NKhVqSP/iblJo5Kcgl2xMswpMVvXEytpqLpSnC1gBoJTDbhf3lo91Gxp3FX1VxaIA69ZoRAa/mz1x4k2TJv22ttbg4Mwba1XIX7kJ6ws38wGW7DzQST+EGtXf8EDfjBhm+bDaEAwYpOa4penHWnn4lv0UGAKseNstWI8nkybVBu2V9ukpd+xqH5llG4AgtARl6zOKYYUyPhlh+s5R8KowdqUY7XxPWtoXiz/UBrnZb48Y3Em+Z43xANxJl1JDNoevV/OoqBkaN8KYpLyzTZvrkSzz0w3d1ws6s3j20JqseD/URCVikjeJVyKKZDHIq9HbdVoweTKv6uXqKDZ3aTZDKcxE/EueNShzbHyPDWyBbeE4KTzCQ4A1SC0RYxK84BPdZuRlNoOSKlpRlCcfcGAF115Zq6NIFm0KiRqRcj4ssDY0ACplNGRyHD5rQEywEnspOGifiDYEWBVolowpyMt8kjVBXLM8FOEv6FeS6tAGg6LlyisFiYIkS0RKdeMUs4VH2FY1JecuwWUyheRssKn6T24x42wvrzrDGoYAKxljGrBCevkTwa9c29AARBBQsGkUNQQh962TdGAFiw/qIoI6LAZJFodyUJme0AbArc6heen4IkpHlktn/+T/BRgA6j877nW99XQAAAAASUVORK5CYII=...
```

В общем виде [формат](https://www.rfc-editor.org/rfc/rfc2397) выглядит следующим образом:

```
data:[<MIME-type>][;base64],<data> 
```

- `<MIME-type>` — спецификация типа носителей данных. Например, `data:image/png` сообщает о характере данных: «файл изображения в формате png». Если `<MIME-type>` опущен, значение по умолчанию — `text/plain`;
- Указание `;base64` означает, что данные закодированы в base64. Без подобного указания данные просто представляются с использованием кодировки `ASCII`;
- `<data>` — закодированное содержимое файла.

Найдите в сети декодеры из _base64_, чтобы получить из строки выше изображение.

## Новый код в сериализаторе

В проекте Kittygram изображения котиков будут закодированы именно в формате base64. В общем виде вся система должна работать так:

- изображение в виде закодированной строки передаётся в соответствующем запросе к API на добавление или изменение информации о котике;
- закодированная строка декодируется на сервере и сохраняется в виде файла изображения в каталоге _cats/images/_;
- при запросе информации о котике в ответе API возвращается адрес файла с нужным изображением из каталога _cats/images/._

Реализовать в сериализаторе эти требования можно при помощи кастомного типа поля `Base64ImageField`, который нужно унаследовать от стандартного `serializers.ImageField`.

Именно этот кастомный тип теперь и указан для поля `image` в сериализаторе `CatSerializer`:

```python
# cats/serializers.py

import base64  # Модуль с функциями кодирования и декодирования base64

from django.core.files.base import ContentFile

...

class Base64ImageField(serializers.ImageField):
    def to_internal_value(self, data):
        # Если полученный объект строка, и эта строка 
        # начинается с 'data:image'...
        if isinstance(data, str) and data.startswith('data:image'):
            # ...начинаем декодировать изображение из base64.
            # Сначала нужно разделить строку на части.
            format, imgstr = data.split(';base64,')  
            # И извлечь расширение файла.
            ext = format.split('/')[-1]  
            # Затем декодировать сами данные и поместить результат в файл,
            # которому дать название по шаблону.
            data = ContentFile(base64.b64decode(imgstr), name='temp.' + ext)

        return super().to_internal_value(data)

class CatSerializer(serializers.ModelSerializer):
    achievements = AchievementSerializer(many=True)
    color = Hex2NameColor()
    age = serializers.SerializerMethodField()
    # Вот оно — новое поле для изображений.
    image = Base64ImageField(required=False, allow_null=True)
    
    class Meta:
        model = Cat
        fields = (
            'id', 'name', 'color', 'birth_year', 'achievements', 'owner', 'age',
            'image'
        )
        read_only_fields = ('owner',)

... 
```

В сериализатор также был добавлен метод `update`, который отвечает за обновление данных о котиках:

```python
# cats/serializers.py

...

class CatSerializer(serializers.ModelSerializer):
    achievements = AchievementSerializer(required=False, many=True)
    color = Hex2NameColor()
    age = serializers.SerializerMethodField()
    image = Base64ImageField(required=False, allow_null=True)
    
    ...
    
    def update(self, instance, validated_data):
        instance.name = validated_data.get('name', instance.name)
        instance.color = validated_data.get('color', instance.color)
        instance.birth_year = validated_data.get(
            'birth_year', instance.birth_year
            )
        instance.image = validated_data.get('image', instance.image)
        if 'achievements' in validated_data:
            achievements_data = validated_data.pop('achievements')
            lst = []
            for achievement in achievements_data:
                current_achievement, status = Achievement.objects.get_or_create(
                    **achievement
                    )
                lst.append(current_achievement)
            instance.achievements.set(lst)

        instance.save()
        return instance 
```

# Проверяем результат

Обзор изменений закончен — можно проверить работу API. Убедитесь, что миграции применены, и запустите веб-сервер разработки.

Сначала создайте нового пользователя: [в djoser это можно сделать](https://djoser.readthedocs.io/en/latest/base_endpoints.html#user-create) POST-запросом на эндпоинт _users/_, к которому нужно добавить новый префикс _api/_. В теле запроса укажите _username_ и _password_ для нового пользователя.

![](https://pictures.s3.yandex.net/resources/S09_08_01_1700219318.png)

Затем для нового пользователя [нужно получить токен](https://djoser.readthedocs.io/en/latest/token_endpoints.html#token-create): для этого воспользуйтесь эндпоинтом _/api/token/login/:_ отправьте на него POST-запросом _username_ и _password_ нового пользователя.

![](https://pictures.s3.yandex.net/resources/S09_08_02_1700219332.png)

Теперь, если отправить авторизованный запрос на добавление котика…

![](https://pictures.s3.yandex.net/resources/S09_08_03_1700219349.png)

…и указать в качестве поля `image` закодированное в виде строки изображение…

```
data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAoAAAAGqCAYAAACbEvXuAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAhGVYSWZNTQAqAAAACAAFARIAAwAAAAEAAQAAARoABQAAAAEAAABKARsABQAAAAEAAABSASgAAwAAAAEAAgAAh2kABAAAAAEAAABaAAAAAAAAAEgAAAABAAAASAAAAAEAA6ABAAMAAAABAAEAAKACAAQAAAABAAACgKADAAQAAAABAAABqgAAAAD+Teb3AAAACXBIWXMAAAsTAAALEwEAmpwYAAACM2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNi4wLjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8ZXhpZjpQaXhlbFlEaW1lbnNpb24+ODUxPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgICAgPGV4aWY6UGl4ZWxYRGltZW5zaW9uPjEyODA8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpDb2xvclNwYWNlPjE8L2V4aWY6Q29sb3JTcGFjZT4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CtH1QpcAAEAASURBVHgBrL0JmtxKsqWXI3lv1Wt9rWVoL9r/Pvqpqi7JnPT/55gBiCTZr1otzwy4uw3HzM0HOBCIiPv/+//6+8fdT+nj7iPU97v7u4e7+4dn6pbv72R8yLynTLonh3IihDz1yMlqXawjCXFUWhDy/vHxhvr+9p66stqpzmfNVVm/69eFevfxfvFxGA8P4hQrbRp6myb9A4+r9/6OH5AejMfImaXt9z9jh3eQ8fsDrYtiWefRlt1PXBsn6pE36shhwz/DIfmEkm9tY0NJ8SrrRvRqKdU5/Ew5MCmIcafPh1j7Ie0VoSbHj9FU1mLiqlCTpPrY+m2sR3dkzcqv1oVcbNpVjTg4srqZCMKzz+7u3tMAXMGXjcy9fqlvbOTzvyMyJA+8PpDTxoPtJ0nepNXoQvtgTNzzenq6v3t6fLj78+vT3dcvT8wXepC6r/uHJ8Qf7368vN3957/+dfcjHfg4EPiKH3EFI/m7GtPzta29B+bGPZjK3jtPGJ02I68WXl9e716w8Q17//z+dvcv8m/QnL1vxgb9vz093f3965e7r/j9x+PH3fM9bXB8v78xzN7Be797v4xp2+wrB/2wiNFHPV7/5JMuakOQ+EmonB7jtvzKePzAW1+3yXlH39jYSdcxvrTNr3JLMxf1Qyf5N/uVZ1pwzFxMqTqp/aXew2/adbVdH6uzCNfccfvx4JHEeGs+EjP+1o+1mRjRR3rZY7QYi4yHw6fSckwjLfnaEV8bV19L8RiFo/quLVSv8dY1eyn6MXKIXwr2GKrhe/jFeAn1VAnuNji6tXG1fePfGNhxZ/uv3nc1GCPvV442jd7PSU8T+k/iO16mt36pWJ5H+xJfbEvab9YxxezKXBQgJpAJ9siVWB9szW3bD60LXRSVL22XJCj/DomPtL1rkgh7Xg1TQpIYvm5TfBw/Mjf1FxElY4aDPtrUjOAJ3krdT+AqkyhEd+O48yhY4h5ujKwMkpk6h4fT10yfJvILd4iTKVsAcPiLLDwKcXfQY2oOZjlnILt98MFaaUo7B0dc9xePrK0NAn5rYOaa7ek8jWoOcyqK1RCmLYmhTFLiJ12opMy46NS+RI1XvjLjK0CqOT/1T9duk3ofd08fh3LEc8LUtElnTG6C3D/ZqCFhdkoKaWHTGCyXY/BHVpmLaNQuLNnXBcmGOziWZsdd0w6ogw97O+pGDj1Pxp/TBqd00NHfNq/s4q2tTy4gdmmAylbjpt4Sr2F3QFz9v8ZSFQQv7MPuEoPthkHPEIyslTGQXpIH6+C1rhOJI9VsWhhgqzUSk40DyFta30+Z1ZocoS4sDjLauwPXwZJwG1OFToSzJHHsHcQzXlVS5uy3SOvbodaC/ahpNy7qSX3MZilV/OqmKQsNZSHvnZLAd3JR8B/gD80d+No3leBFQMda5fXjnk2UIOzzGGPGwA3hw90zr/uMOXUf7l5f38J3oXD537hoQZxMbQq6d/Z9HE1dmY/751wgPT4+IfesQbR5McfW09eX73f3P37c/fjrx93H67e7d+zKW774jwyiRyy6YKmph0q07LgsbfW6mVYKiv9puOP79DVxWSPC/SYp1xgqAEL/g3VV2RjU5Am8dH38ZZpBO95W5KaiSVt6IoikiC9TcohbT6PLypxotK9chJUP6aSPyiBqpWnbkJr+LkuMS3WkyVbA4pbN7SfsZXCQzfxTr+v6ykrRr599W1+2T5pf9UZrVM+oYdm1fURPuraaDmudZBAVPqgt3poaTVgNZpqbizjavTSF1l8hjUHms+jUj1Oa9Lg4ulR+1b6jEYf1KYy763Hs60faMUx9SV3j+hGCx5ZTalm5zJ05J5rprzq10YrIEiYEFMsdqGRLSZ5G61dTPRutgGhXXm8txN0BXxujStYNTuso+Y+Qvrfdxn58M68xxBvjWnA1I4WpUNeZYO8YhRwZxZDT2/U/BZkR8NKVIj7oa3UqaVlazFA+AC1/TsqJ1P9iInNGrVin2rQH+epgLWWtXryYcZkx6kV01m9RtFa5+j5ASzPnX2oOBtVi4mMfoD32evOo/FGvnkcxDMJQxEixHU6lm8ae8xA/6OKxAVT+Nuk4gP77QiF3/yjvpMudM/QdFCZYFZ56aXo2zDVqsCjXX5mnvlg617tgZcm1cfcOIHSt9yRPYZJY2ZyGq2xf9sWW9fvBM98l1fp1sJ9M5fmP+w9enbOxUD93AUesQaeSHUNx1ElSFwOLseTh/jLTn/iLVbzlKEWiOOcwFWs4YZ+H33Mic8FwwsS/U3lK46mO82/E9MPW6cEOaP1sl84kqXgwGrv2Mwq/TNFHRx/OBCF9uBSZS7NPl+44OKJDv+AfA8D+Ufru7S2O2933lztmxyRkLOUqNihYANcx6R2vWvNip/35BiGWxnY3QkrVN3spQYIi7+X9FfsCPt49PT/jCpuvwXp5faH+fvcKDQ/ZsM69ZG0YT2i2N2MZCLug1C6pzoFs9ti6OW0/sHH/8OXu8ZG783rJhtC14wG7r/d/3T3gx/33V3gvADl/3PDd3z2zKfVlfLLWYOj9gw0pd/8ekUnrtAWW/qRuMSnE8M4eWN5t3v7acTI8wDK0PJAik+Lgjlh4U1bGdaEao6du+K2fta1XOTIc9NWWyJWW2BaguBe1+q3+SXRMb73+gHMKKpy0+DWijOQTp+V4UIU9gp94juhVwnLn3wqb7wxou9KgCztmOWSxP86OF4EtXl2T9rm+cuRHe0cmMZQ+arF5kb8Wf8U7abdGE+ow21+O09i6xLv90fh2bIhRHFV3bGZuc8em9Y6AtCNG6mHWVpRibWwUo7SgQm8Y1w55MC42Mz/FhBb/i7/HkrqW6sPe2Aidgxf2+imsN+uKXO3p5QNWN7c/xuXUxQrdAgDGpuctxgsXp8FMMGfui7MOVgUZKAoOw0wbV39cOEKH57sk5VUpagzYxl5QZJH3xoNA9RepT+NSlOiiYioaNHX4y137SHRcREiY0OpjaFNvvxZRjU/mrqItE5f6Nqx1BsV4sHXZY7d9QAVn1c1WINIRSRuCFvmJUspQqZaiLhagO8/JjmMqEDxfbb9mMxjlAlnvTSH1RATLU0WUrXup75/tKNkhkDkEgfsX68aFmw2IdV36TRJNILJbjJUvbo1yxKoNSUttsGIT9HSWdYlhTK7OuBeZKQdDeVLsEwE7OOct9A1WTs6AHVePs5K006rbSdhyjzWgrQToYOmUAyRDISfO2L11Nr4cKhTsVP1XW/+cFEeqqbPqCdmaE2bktFd9CR2IkYnWAjTPMXqrE6Ec0mYnIEKPxCHtS3tOmZsSOPaW/yZtWswmaoiHrwokLvBHPhkH3YlLymyaoFz7YVnJEyhLq23ctx6JAzNQ+LN3V9M7T493j9590yffJlUod8psA2XqhuLt9fXEwVfb278d9TYgLZHZpNx2KBTdAoaNFSZY5B7tYHZ3mWyvH3evGHpjR+fi96/v3+/++dd37/2xwPN2LJsux5+bwcRCP3nF73fv7GmruMq7M7x/VIfIZ8bb2kjRLw/pV+Xe79kc+rZzbkn6drRYbasbPvvfPI3CQO7q4987m9e4AGpxzZ1HNt4Zzh8MY1i+GJ8SjCu3fdzxqKSxCyo+3GJANbYD95C4nxLpX4Px22Q7kI+r2jtlTxR9ayqXWggjS7btt633xHhxpNe5CuUiFYKtsZMCk4P4P9elxj39GrnFDi84Y0IC6YBrNUfnnD2xPD2fnhkp1+tTIn6nPmztx4dFGLpasqI9vJ9FItw+pajwZBWlDy86mjnThTHExOMUuJTqyKqbX2N1eDnGOvdXnbZD11pOlE50Ui7+ExpiF2bIgYqduDc+Dl967j1RLyI4E6FkWQAHh2zcOeJy+Dnxz5BGp7hi90LU3jotUHJy8n9sAglkdMfUzqk0cuzqsjDyLJtnrrpmQPDUZ+6IXT1VbpIKyvC6TdOvumkKv0I7TTObY2B8TRsGiMz53M1RIQIj+9KwjfHe6NGO7LTJ9kCwnHdhVA18DlMudim2Y0rxG92NAfUhdSpULRhqRGsOqQ9R26eFIa78MRZKj6hGrMYY7TcGkpZG3rZBHEGX9cNMPSlriKpKbrzPdoS+Ew47K1cJ+2T3Q3pAHQHPjdrnVDlJrZ9636iVH3w7FgxhpCef+oiVeOnYaitvFyN8CJ7FI7iLWfjoZPJraBq4A0VcoQq3HeydjQ6WD99+06Yvzep75Mn7n4Wl1LCCpZkuOBZYNThRS1OOLAPQuz3xeYixgZ1KKGWyvrTW9SNcyaTJQttyYgTHLtNwEG76ZSVBAvCwNsBbr4U5xl83RUIW04qDMviKfVJMmyDWn/rqGloxtXiZcUhWSu6ESf1t+mTnKhf/umZDHkuJq1LWx66lMWr2wCYnb/NaZgNouSGbscDsF/aNtuctWO7EuZBkXEA3wcICz1iO3dZo/zYuQhG9PcDPdo07DcbT5wHdCP71jx/sO2v3+7e/7r59/5bNYFaiQdDHPpbkOG3/JJ465v/0m+1LX79/v3vkTt2bz+rxenh8vXt8/gLkEzj4ipzP/71w69KNJ/8ZwukhYvLIHHgm94TgPPEta+8K2sYuETGaOOyKbfOhtpcpWO/hyKT8lCIH1bh+Tvrj+JJXuRZWp/IqDvcXGJ8xO2dvEZQ5UU4NpdLfI37IHAX5n4xGdhQMGHxHV6VGNvS1etqzVPXRP3RbP2wFBho4clLlIKw1h8WZrNSHpZW9QsVeXvPqCJz168KUc2hY8DVQk12kL8WL3AWBIlq/ULzaTfxiNIeYvIEbM6Ed/dGxszE6PMn6PjhMrJYY6wrgh2zHfdtFRYHDRR1dnV6g2bNe2MnJoyMWeNkX+u0WriBkSdIWV0H+eUVUlj5RjyZtydzPrsg+RFYGSbuuCdquBWamwpMyb4ISE2BeeMpMPa3Jrke5OZecokUbm6nAiydeNJOWFRUPN7pwqeuzdg4ZS9DsqsR9GqwbbWWgq5EGj+7CCzRtzTUuWjnXCpp20Sd0pCK70RexfliaFIcoo7ZpSTwmW3JslZuN15hYucSVinn+Jq62I6pTF0EzqxfEC69c+/t0RtlcXIzW9uGuA1Xv6uKxa3OQ67u+tprGK7/TQ3otHSdS+kLqvsqtDd9LaqSnFQqZNm+t1WnAJ9YhOuwAsXFK4LAi2ZA5sK8p7tSLc7FF5ICfgjgdTDMwt6XBLaIwPYFOZzlI1CJvdzn5qV/BwXnwDBliJ6RoEYFsZ2gqz8xNO2rtHMrKitDBaWHxQvypxfWluEpsWpvmWWyimXtDEWn0xhpZcOIT9qgnJA1CW6PvaKpxpCGENoyNTWmf/RJbpTN5JXFSbtBPof+Nku2wvzsRtGTP104mifyhzPqRfn3iQw32QWLHJQ033/DTPxZzyr4V69u5vSPHRo3x+eDmnnQM/4nZbgATwcis/foWpeOgzYe7F3Ux6pu7H3zwwpS3pflAk4tVrlqzG2vEPRnZEFyahQF9HAyZdtiVmtYHH0FQVdr728vdywsFxrLj27d7n77+mQ3g0xeeD+Qt4Zdvd3ffvr3cff/xcveDZwFtuwuA2E/46h3Ax2c/tNIPrrgBNAYPXgq+vUbeGydGPg6S5S6hMsjqs0m8LYfw+XCRlWXfJhkrXzaIJFnU9O9BsVB+ShQP/cj87lAjAx07O8avGous9LrlaJDuuDLuHftXSftl66I5TjmGNOWSb3y91UAg+BWUZyyai1h/9GFNxRcNpUOUQSoYHJKkRGrqZramc6dzaVhRWb3Nh3dk0D1jm3Qo9n6W1b/1/Vciq6qvN+kMGmqRgq2QZUY1wF6cVK+0xmBIgi2GuSi46x21Y72C7FrF/W+o8NeHmAuz1lIXEPlDyE1jRmTmbizgk+1Nv+CYfp/ydQduCjGlrDppROXXiawHCNlDbmaqpweTaJN38pWrTWf6dX5gZhaE8BsorUdBq6aECHz7KI/HsKDUn7BHJt6mHG9Rjd3Rb9s7kk5JZEDSSu3bApGlymtK06xBzFvAAqfV6lUqKJJJYnWjApLsiLg2jezIBXCHp0qKjozlQ2y8iTaHnlenLQiVXp/Tr/inz9EfXPEyFsUtYyykMu1Sqj4eawjsIi/veAM2OL3xkl6NvZ7bZrOrIV9p024TjdT0nnQdTjzrTsQd/nrShp38inCcoMVXe6s+P+3JpUYLgvaotTNiU/RPScfL06FtPmU9MoXZYiltSCmy68TW1fPtrMpeOkeocVjZ2rRBSKKTuz+c2DrpJHuXww2j/NpIkNUNjj7y2pg49KjK00MrdEcMxRd5K+7Jl/I2cfnmwsFKqlkV/eevhOH+JlvQA6Vo7euW+/bT6mNVZ8LysNsX/KPmS2rjgg/I5g6pOtL5u/aB8pvOAQwl4uXu8WyOzOKtbsMqAvQZqG0a2ioe4kdhSKKjR/81xrW2uPoqTqgcHtlgPfB6/PIVIjq83rkT9/7+wrN2vv3aJefFjQ0D3Y1NpqI4mBbHK+11yWf/0lccnRdimpTryOWoA+N2x5TjzI91cOTw/qbvTFzvSr66Ad2LITapYzO+imEjfY0FClO3oFXwuB2wC2bGJfLvtCfqrz94zu87MXjibW9Od3xI5O3jic3f293378SA96dtj0hPXNn7CeVnN36Un554ZtBNH7s/vOyTIuDxceW7D19aIDDRp81td+Mf2/HOQ/1sNVrDQSqC8o2elWuqbLmdaxipjpgyJjbNkLlJYipifIm5PAXBOCwN3NEG+MEafPs9ICkIUPNF7hg8KPFNi2cKaYx58kgRAx1P1ngpNB6NaOr1Y7GMb8v1fuOohpTJD/OOT2m+HLMmMDJoU+RQ6kRGASj8xblb/I7jSkQQzMTFA3b25KlJ5+CuI9s0p7hjdNsQjJEtno7LV9DiemyVsjRzyeJY9aCvm6HbmvYjAX9pREFZhnPf7nJeu/kzaZcSNn0SqnXpg2ERVV1LMb5RGdsrFrY0ZcUs+Cg1K4dy8CJIBU2KTWpaQb/Zkg++8q5JpjQzchyiIIPy2E7rR1b5njm7aVDNlAutex88mbguQ72BE9O/9s8Qg6uwY/MQFPEIDZVgOF8iDu9wGn+XeqpXqmqOq+pbNx3ntqHXVSv6xhFC1sJULEdNq7cJ+rA61KhkHpCLEfkRMBMn1QttAfI4CgK1pTJCcaQmj3lPNe0RL6z2tMX0QYyWZlzWh0OWAnfjVpnc+Fn1qPTYNi8DGuN+5kKGB/VDh0KGcqTUvl0/O6c5F8QMIGng2gpQHfBtsySzRqH1VDcwGIgHGhGkWeI0/upCGmMdnEGt7B7Fn8mqbAZ0TsrjfPzjwK1zJ7V3Xz7c+PlQ+/gmdl7ZAOpHLZ0bnYvlcVXz20zLgWIx7Z0ig4wOr/ptrtQkynsXCc1tfZjWMrGoaXX6anjJbg6BzeHiI8Ube/ix3FiTL7avKVsPzJHjs4sG/GjD3MEKFT21oWVz23IxVHLqXGkRvRzgrTGoTtCsT5DT3nFKX492jPyYPbAcIYK1D0+/FKiP+rExZaF088ddsMdnn3njww+wv7OJeSF/4c6XH7jwZPHKhql9OIYznLTGM3iQ2KrFZjd92rLPbUvHGcVEoONxMOITh3DwaYXAcgnOiYgGa2XbmfYj9+Z8k67uGj1gKaiQeonXDaC8/EWMBxDZ8D642eXTvvcs9Lb9h88fGgxkMi/okEfOKn4yOXs+NosPvnX8TMt9y5o9rJ8G+3hhQ/nwjf7zE8Q/2HyCP85n7NedLNSgk4ZgsQRILRxtlndNF5UWld+XglCDYXyGdWYXi3KVpXEUE83oDR1ix1P7WSgF7cPgphaEcE7gkZ+35w4JbRwDmG6rFrQp0GCLi739u3NrpA4J9TZG8Tg4p/bqpRUB1gHxR+YibzEv2r+trd74hIpaPtfo2HReLr5+xJdxULnzGUxqApNsT9tchawnouZfLXE2KlHIHDgAIlGcbkJLyFclxYFz43L4Vq8DphuxEocHLLTa9q6ZLNceZfXFee1/T37GotH7BBH5NZU+6aFr5uBVs7YgRafjYe5SxQ4MdRXDSNY/nYll87Il2ca2MwLhHSMz9gvjUX+...
```

…то в директории _media_ по адресу _cats/images/_ появится новый файл с переданным изображением, а при запросе информации о котике, будет возвращаться ссылка на изображение с ним.

![](https://pictures.s3.yandex.net/resources/S09_08_04_1700219392.png)

Изображение — необязательное поле, поэтому можно, как и прежде, добавлять котиков без фотографий.

![](https://pictures.s3.yandex.net/resources/S09_08_05_1700219405.png)

# Выходные удались

Казалось, что всё пропало, но решение нашлось, а реализация оказалась не такой уж и сложной.