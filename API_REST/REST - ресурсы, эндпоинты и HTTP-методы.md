[[Фреймворк Django. Работа с проектами]]
[[Python]]
[[API]]
[[Питон Практикум]]

В базе данных проекта может храниться множество разнородной информации, и задача API — обеспечить доступ к этой информации. Ключевая абстракция в REST — это **ресурс**. Любая информация, которая может быть названа, может быть ресурсом: пост в социальной сети, коллекция постов, подборка актуальных новостей, пользователь сайта, коллекция любых объектов или других ресурсов.

Унифицированный указатель **ресурса**, или URL (от англ. _**U**niform **R**esource **L**ocator_), используют для указания, где находится тот или иной ресурс.

```
/users              # Ресурсом может быть коллекция сущностей

/users/12           # Пользователь c id = 12 — это тоже ресурс

/latest-news        # Ресурс не обязательно должен быть статическим: 
                    # новости каждый день разные, но ресурс — один, постоянный

/users/12/playlists # Все плейлисты пользователя с id=12 — это ресурс, 
                    # содержащий коллекцию ресурсов
```


В терминах REST URL-адрес, идентифицирующий ресурс, принято называть **эндпоинтом** (от англ. _endpoint_, «конечная точка»).

# Правила именования ресурсов

Для обращения к ресурсам через HTTP-запросы их необходимо как-то именовать. Чем понятнее имена ресурсов, тем проще разобраться в API. Здорово, когда по названию ресурса можно понять, что именно он содержит.

Чтобы с вашим API было просто и удобно общаться, соблюдайте простые правила.

### Ресурсы — существительные

Почти всегда ресурсы именуют существительными во множественном числе:

```
/users

/api/starships
```


Иногда для именования ресурсов применяют существительные в единственном числе:

```
/users/{user-id}/profile
/users/me
```

Иногда можно выбрать глагол в качестве имени. Но такое имя бывает удачным крайне редко:

```
/users/{user-id}/cart/checkout  # Проверка корзины
/refresh  # Обновление токена
```

### Слеш для иерархии

Слеш в URL используется для указания иерархии ресурсов по принципу «от общего к частному»

А чтобы обратиться к конкретному посту, нужно указать его ID:

```
/users/{user-id}/posts/{post-id}
```

### «Висячий» слеш

В разных API встречаются два способа описания URL ресурсов:

```
# Первый вариант
/users/{user-id}/posts/  # Слеш в конце URL

# Второй вариант
/users/{user-id}/posts  # Нет слеша в конце URL
```


Бытует мнение, что лучше избегать такого «висячего» слеша в конце URL — ведь он не добавляет информации.

Другое мнение заключается в том, что висячий слеш обязателен для любого ресурса, который может содержать дочерние элементы.

В REST нет однозначных рекомендаций, какой из подходов предпочтительнее. Придерживайтесь документации тех API, с которыми будете работать.

### Дефисы вместо пробелов

В URL не должно быть пробелов, их заменяют дефисами или подчёркиваниями. Лучше применять дефисы:

- на некоторых устройствах подчёркивание может выйти за базовую линию строки, и его будет не видно вовсе;
- несколько подчёркиваний сливаются в одно.

```
# Делайте так:
/users/{user-id}/user-devices

# А не так:
/users/{user-id}/user_devices
```


### HTTP-методы

Любой API предназначен для получения доступа к ресурсам. К ресурсу всегда можно обратиться по URL.

HTTP-метод запроса определяет, что следует сделать:

- **GET** получает ресурсы;
- **POST** создаёт ресурс;
- **PUT** заменяет существующий ресурс целиком;
- **PATCH** частично изменяет существующий ресурс;
- **DELETE** удаляет ресурс.

Реже применяют ещё два метода:

- **HEAD** получает только заголовки ответа. HEAD похож на GET, но в ответе на этот запрос есть только заголовок, а тела ответа нет.
- **OPTIONS** получает перечень HTTP-методов, которые поддерживает сервер.

### GET — это «получить», DELETE — это «удалить»

Сам по себе метод не определяет логику работы сервера. Можно запрограммировать API так, что при DELETE-запросе будет создаваться ресурс, а при GET — редактироваться.

Не следует так делать, если на то нет особо важных причин.

```
# Получить список пользователей
GET .../users

# Создать пользователя
POST .../users

# Удалить пользователя с id = 2
DELETE .../users/2
```


```
# Так не надо
GET /get-users
POST /create-user
```


## Идемпотентность и безопасность методов

У HTTP-методов есть две важные характеристики — безопасность и идемпотентность.

**Безопасность:** метод, который не изменяет ресурс, называется безопасным. Например, если в качестве ресурса рассматривать никнеймы пользователей, то сколько ни отправляй GET-запрос на получение никнейма конкретного пользователя — к изменению никнейма это не приведёт. Метод GET — безопасный.

Метод, который может изменить ресурс, в терминах архитектуры REST считается небезопасным. Такими методами могут быть PUT, PATCH, DELETE или POST.

**Идемпотентность** (от лат. _idem_ — «тот же самый» и _potens_ — «способный») — это свойство, заключающееся в том, что многократное выполнение этого метода по результату равно однократному. То есть, выполняя один и тот же запрос много-много раз, мы всегда будем получать один и тот же результат. Даже если сто раз отправить GET-запрос на получение никнейма конкретного пользователя, ответ не изменится, он будет таким же, как если бы его отправили всего лишь один раз. Метод GET — идемпотентный.

А вот метод POST работает иначе: обычно это создание новой записи, например добавление никнейма, независимо от того, есть уже аналогичный никнейм или нет. Если десять раз послать один и тот же POST-запрос, то будет добавлено десять идентичных никнеймов. Метод POST — неидемпотентный.


