
[[Питон Практикум]]
[[Python]]
[[Фреймворк Django. Работа с проектами]]
[[SQL]]
[[Описание связей между моделями]]

### Первый этап: подключение БД к Django-проекту

В мире есть десятки популярных СУБД; Django 3.2 «из коробки» поддерживает [пять из них](https://docs.djangoproject.com/en/3.2/ref/databases/):

- PostgreSQL
- MariaDB
- MySQL
- Oracle
- SQLite (подключена по умолчанию).

Есть расширения, которые позволяют Django работать и с другими базами данных.

В этом курсе мы будем работать с **SQLite**.

За подключение и настройку БД в проекте отвечает константа `DATABASES` в _settings.py_:

```python
# <название проекта>/settings.py

DATABASES = {
    'default': {
        # К проекту по умолчанию подключена СУБД SQLite:  
        'ENGINE': 'django.db.backends.sqlite3',
        # Файл с базой данных находится в одной папке с manage.py.
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}
```


Прелесть Django состоит в том, что если появится необходимость подключить к проекту другую БД — будет достаточно поменять настройки в _settings.py_, а больше ничего менять не придётся.

### Описание таблиц

В Django-проекте **acme_project** управлять фильмами будет приложение **cinema**. После выполнения команды `python manage.py startapp cinema` будет создана структура файлов и папок этого приложения:


```
cinema/
├── migrations/
│   └── __init__.py
├── __init__.py
├── admin.py
├── apps.py
├── models.py        <-- Тут будем описывать классы для БД.
├── tests.py
└── views.py
```


## Первая модель для первой таблицы

Таблицы БД создаются с помощью ORM в два этапа:

1. **Описание структуры** **БД**: в специальных Python-классах (их принято называть **моделями**) описывают типы полей и связи между таблицами.
2. **Создание и выполнение миграций**: при выполнении миграций Django ORM на основе **моделей** создаёт таблицы в БД.

Начнём работу с создания таблицы с фильмами: в приложении **cinema** создадим модель `VideoProduct` с одним полем: `title` (название фильма или другого видеопродукта).

Модели наследуются от класса `Model` из модуля `models`.

```python
# cinema/models.py
# Импортируем модуль с классом Model, от которого будем наследовать модели:
from django.db import models

class VideoProduct(models.Model):
    title = models.CharField(max_length=128)
```


При выполнении миграций на основе этой модели Django ORM создаст и отправит такой SQL-запрос:


```sql
CREATE TABLE "cinema_videoproduct" (
  "id" integer NOT NULL PRIMARY KEY AUTOINCREMENT,
  "title" varchar(128) NOT NULL
);
```


В результате этого запроса в базе данных будет создана таблица **cinema_videoproduct**.

- Из названия приложения `Cinema` и названия модели `VideoProduct` Django ORM сгенерировал название для таблицы: **cinema_videoproduct**.
- В модели описано лишь одно поле, но в запросе видно, что будет создано два поля. Django ORM автоматически создаёт поле `id` — **первичный ключ** типа `INTEGER`. Параметр `AUTOINCREMENT` указывает, что для каждой новой записи значение этого числового поля будет автоматически увеличиваться на единицу.
- Поле `title` будет создано на основе атрибута `title` модели `VideoProduct`.  
    Тип этого поля определён классом `CharField(max_length=128)`; в синтаксисе SQL тип этого поля превратится в `VARCHAR`, длина строки будет ограничена: не более 128 символов. Значение `NOT NULL` добавлено автоматически, по умолчанию.


### Типы полей в Django

При описании поля модели его тип указывается при помощи специальных классов. Вот несколько популярных типов (в скобках — название аналогичного типа в SQL):

`models.IntegerField()` — натуральное число (INTEGER);

`models.FloatField()` — число с плавающей точкой (REAL);

`models.BooleanField()` — булев тип `False`/`True` (BOOL);

`models.CharField()` — строка (текстовое поле с ограничением по числу символов) (VARCHAR);

`models.TextField()` — текстовое поле (TEXT);

`models.DateField()` — дата, как `datetime.date` в Python (DATE);

`models.DateTimeField()` — дата и время, как `datetime.datetime` в Python (DATATIME);

`models.SlugField()` — «слаг», для строк, состоящих только из цифр, букв латиницы и символов `-` и `_`. Обычно слаг используют для создания человекочитаемых URL;

`models.ImageField()` — для изображений.


## На заметку

- Как подключить базу данных к проекту: описание в [официальной документации](https://docs.djangoproject.com/en/3.2/ref/databases/).
- В Django есть [множество типов полей БД](https://docs.djangoproject.com/en/3.2/ref/models/fields/#field-types) на все случаи жизни.