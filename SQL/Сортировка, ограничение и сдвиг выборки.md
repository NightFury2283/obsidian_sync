
[[Питон Практикум]]
[[SQL]]
## Сортировка данных: ORDER BY

Для сортировки результатов запроса в SQL есть ключевое слово `ORDER BY`. Обратите внимание: `ORDER BY` пишется **после** условия `WHERE`. Это логично — сначала выбираем данные и после этого выстраиваем их по порядку.


```sql
SELECT title,
       release_year
FROM video_products
WHERE release_year > 1980
ORDER BY release_year;
```

Вернулись те же данные, но упорядоченные по дате:


```bash
('Она написала убийство', 1984)
('Кто подставил кролика Роджера', 1988)
('Паркер Льюис не проигрывает', 1990)
('Последний киногерой', 1993)
('Лас-Вегас', 2003)
('Койот против Acme', 2023)
```


### Направление сортировки

По умолчанию команда `ORDER BY` выполняет сортировку по возрастанию. Чтобы явным образом задать направление сортировки, после имени столбца указывается ключевое слово `ASC` (по возрастанию) или `DESC` (по убыванию).

Отсортировать фильмы в порядке «от новых к старым» можно так:


```sql
...

ORDER BY release_year DESC;
```


При сортировке можно указать несколько полей, перечислив их через запятую. Результаты отсортируются по первому полю, а при равных значениях первого поля — по второму.

Отсортируем выборку по полю `product_type` в обратном порядке (от Я к А), а фильмы с одинаковым типом отсортируем по алфавиту:


```sql
SELECT product_type,
       title
FROM video_products
WHERE release_year > 1980
ORDER BY product_type DESC, title;
```

```bash
('Фильм', 'Койот против Acme')
('Фильм', 'Кто подставил кролика Роджера')
('Фильм', 'Последний киногерой')
('Сериал', 'Лас-Вегас')
('Сериал', 'Она написала убийство')
('Сериал', 'Паркер Льюис не проигрывает')
```



### Ограничение и сдвиг выборки: LIMIT и OFFSET

В ответ на запрос может вернуться большая выборка; но зачастую нужно получить лишь несколько записей из неё. Примером может служить постраничное отображение информации на сайте.

Допустим, на каждую страницу сайта нужно вывести по два фильма из базы данных. Значит, при запросе нужно получить только две записи из БД, а не полный набор записей.


Для ограничения количества строк, возвращаемых в ответ на SQL-запрос, применяют ключевое слово `LIMIT` (англ. «ограничение») и `OFFSET` (англ. «смещение»).

```sql
LIMIT <сколько строк нужно показать> OFFSET <на сколько строк сдвинуть выборку>;
```


```sql
SELECT product_type,
       title
FROM video_products
ORDER BY title
LIMIT 2;
```


Если нужно вернуть определённое число записей, но начинать нужно не с первой записи в выборке — после `LIMIT` ставят оператор `OFFSET` и в нём указывают, сколько записей нужно пропустить.

Вернём две записи из нашей выборки, но две первые пропустим:

```sql
SELECT product_type,
       title
FROM video_products
ORDER BY title
LIMIT 2 OFFSET 2;
```


В результате вернулись третья и четвёртая записи из отсортированного списка фильмов


#### В SQL-запросах, которые вы пишете, порядок инструкций должен быть таким:

- SELECT
- FROM
- WHERE (опционально)
- ORDER BY
- LIMIT OFFSET