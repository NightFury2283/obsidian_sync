
[[HTML_CSS - фронтенд]]
[[Фреймворк Django. Работа с проектами]]
[[Питон Практикум]]


Магазин _acme.not_ уже научился реагировать на запросы и возвращать текстовую строку:

```python
# homepage/views.py
from django.http import HttpResponse

# Главная страница.
def index(request):    
    return HttpResponse('Главная страница')

```


Если view-функция может вернуть клиенту текстовую строку, то почему бы ей не вернуть HTML, ведь это тоже текстовая строка!


```python
# homepage/views.py
from django.http import HttpResponse

# Главная страница
def index(request):
    html_content = '''
    <!DOCTYPE html>
    <html lang="ru">
      <head>
        <title>ACME</title>
      </head>
      <body>
        <h1>Главная страница</h1>
      </body>
    </html>
    '''
    return HttpResponse(html_content)
```


С технической точки зрения этот подход отлично работает, но писать код будет неудобно. HTML придётся писать прямо среди кода на Python, файл с кодом раздуется. Фронтендер и бэкендер будут вынуждены работать в одном файле, фронтендеру будет мешать Python, а бэкендеру — HTML.


### HTML — отдельно, Python — отдельно

Решение проблемы есть: HTML-код выносят в отдельные файлы (их называют **HTML-шаблонами**).


```html
<!-- homepage/index.html -->
<!DOCTYPE html>
<html lang="ru">
  <head>
    <title>ACME</title>
  </head>
  <body>
    <h1>Главная страница</h1>
  </body>
</html>
```


Чтобы в ответе на запрос Django мог вернуть HTML-код, шаблоны подключают через **загрузчик** `loader`.


```python
from django.http import HttpResponse
# Импортируем загрузчик.
from django.template import loader

def index(request):
    # Подключаем HTML-файл.
    template = loader.get_template('homepage/index.html')
    # Передаём в объект HttpResponse 
    # HTML-код из загруженного файла, объект запроса request;
    # и возвращаем этот объект.
    return HttpResponse(template.render({}, request))
```


### Пиши, сокращай

Для работы с шаблонами разработчики Django придумали сокращённый синтаксис: view-функция возвращает функцию `render()`, в которую передаётся объект запроса `request` и адрес HTML-шаблона.

Загрузка шаблона и создание объекта HttpResponse убраны «под капот», функция `render()` сама выполнит все эти операции.

```python
# Импортируем функцию render()
from django.shortcuts import render

def index(request):
    template_name = 'homepage/index.html'
    return render(request, template_name)
```


## Где хранить шаблоны

Шаблонов в проекте получается много: практически для каждой view-функции по шаблону. И всё это надо как-то хранить. Если хранить шаблоны вместе, будет просто куча файлов, но Django — это «фреймворк для перфекционистов с дедлайном». Разводить бардак тут не принято.

Есть две традиционные схемы хранения шаблонов: **на уровне приложения** и **на уровне проекта**.

## Хранение шаблонов на уровне приложения

**В директориях приложений** создают папки _templates/имя_приложения/_ и там хранят шаблоны, используемые в приложении. Такой порядок хранения шаблонов называют «на уровне приложения».

Если следовать этой схеме, то шаблоны проекта ACME должны размещаться так:


![[Pasted image 20250427180732.png]]



## Хранение шаблонов на уровне проекта

При такой системе **в корневой директории проекта** создаётся папка _templates/_, в ней — директории, названные по именам приложений, и уже в них хранятся шаблоны, относящиеся к приложениям проекта. Такой порядок хранения шаблонов называют «на уровне проекта».

Согласно этому подходу шаблоны приложения **catalog** должны лежать в директории _templates/catalog/_:


![[Pasted image 20250427181249.png]]


Выбор схемы зависит от задачи.

- Если приложение планируется использовать многократно, как пакет (с возможностью установки через pip), — шаблоны хранят на уровне приложения. В документации [об этом тоже сказано](https://docs.djangoproject.com/en/3.2/intro/reusable-apps/), загляни.
- В остальных случаях удобнее работать с шаблонами на уровне проекта. В «Анфисе» так и поступим.



### Настройки шаблонизатора Django

Разработчик должен указать фреймворку, где следует искать шаблоны и как с ними работать. Все эти настройки хранятся в списке `TEMPLATES` в файле `settings.py`.

- `BACKEND`: под этим ключом указывается, какой шаблонизатор используется в проекте. Самые популярные шаблонизаторы, использующиеся в Django-проектах, — это `Jinja2` и Django Template Language (DTL). По умолчанию в Django подключён **DjangoTemplates**. С ним мы и работаем.
- `DIRS`: здесь указывается список директорий, где Django будет искать шаблоны. При развёртывании Django-проекта создаётся константа `BASE_DIR`, в которой хранится адрес рабочей директории. Чтобы задать адрес директории с шаблонами, добавим к пути `BASE_DIR` вложенную папку `templates`.
- `APP_DIRS` показывает, нужно ли искать шаблоны в папках приложений.

Вот список `TEMPLATES` с настройками хранения шаблонов на уровне проекта:



```python
# acme_project/settings.py
# Адреса папок с шаблонами можно вынести в отдельные константы,
# код станет более читабельным.
TEMPLATES_DIR = BASE_DIR / 'templates'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        # Указываем, в каких директориях искать HTML-шаблоны.
        'DIRS': [TEMPLATES_DIR],

        # Оставляем True: шаблоны приложений будут искаться 
        # не только на уровне проекта, но и в директориях приложений.
        # Это необходимо для работы 
        # встроенных приложений (например админки).
        'APP_DIRS': True, 
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ]
        },
    }
]
```




> [!Шпаргалка]
> Чтобы ваш код в шаблонах и на обычных HTML-страницах выглядел профессионально и аккуратно — сохраните [ссылочку на шпаргалку Правила оформления HTML и шаблонов](https://code.s3.yandex.net/Python-dev/cheatsheets/025-django-pravila-oformlenija-html-i-shablonov-shpora/025-django-pravila-oformlenija-html-i-shablonov-shpora.html).
> 
> Со шпаргалкой проще, чем без неё!

